[gd_scene load_steps=4 format=3 uid="uid://c5nf542k6cnsb"]

[ext_resource type="Texture2D" uid="uid://bv21kk0km1rc" path="res://icon.svg" id="1_4flbx"]

[sub_resource type="GDScript" id="GDScript_4flbx"]
script/source = "extends CharacterBody2D

@export var max_speed = 400.0
@export var acceleration = 800.0
@export var friction = 600.0
@export var damage_multiplier = 0.1 # Ajuste para balancear o dano

func _physics_process(delta):
	var input_dir = Input.get_vector(\"ui_left\", \"ui_right\", \"ui_up\", \"ui_down\")
	
	# Lógica de Movimentação com inércia
	if input_dir != Vector2.ZERO:
		velocity = velocity.move_toward(input_dir * max_speed, acceleration * delta)
		rotation = velocity.angle() # Opcional: Faz o veículo olhar para onde anda
	else:
		velocity = velocity.move_toward(Vector2.ZERO, friction * delta)

	move_and_slide()
	
	# Lógica de Colisão e Dano aos Obstáculos
	for i in get_slide_collision_count():
		var collision = get_slide_collision(i)
		var collider = collision.get_collider()
		
		# Verifica se o objeto colidido está no grupo \"obstaculos\"
		if collider.is_in_group(\"obstaculos\"):
			# O dano é proporcional à velocidade atual
			var current_speed = velocity.length()
			var damage = current_speed * damage_multiplier
			
			if collider.has_method(\"take_damage\"):
				collider.take_damage(damage)
				
			# Opcional: Empurrão leve para trás ao bater (bounce)
			velocity = velocity.bounce(collision.get_normal()) * 0.5
"

[sub_resource type="RectangleShape2D" id="RectangleShape2D_onrkg"]
size = Vector2(130, 128)

[node name="Player" type="CharacterBody2D"]
script = SubResource("GDScript_4flbx")

[node name="Sprite2D" type="Sprite2D" parent="."]
texture = ExtResource("1_4flbx")

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
shape = SubResource("RectangleShape2D_onrkg")

[node name="Camera2D" type="Camera2D" parent="."]
position_smoothing_enabled = true
